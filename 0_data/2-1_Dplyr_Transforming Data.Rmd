---
title: "DATA MINIPULATION WITH DPLYR: TRANSFORMING DATA"
source: DataCamp
---

### 1.1 The Counties dataset 
Load `tidyverse` including the `dplyr` package:
```{r}
library(tidyverse) 
```
Import the `counties` dataset in form of `.rds` file in `0_data`:
```{r}
counties <- readRDS("counties.rds")
```
This is a big dataset which contains the result of 2015 US Census. A state is one of 50 regions within the US. A county is a subregion of one of those states, like Los Angeles county of California state.

<img src = "https://assets.datacamp.com/production/repositories/4984/datasets/632a7f6ee2987aa0a3d04a9e6100375d0c7deb46/map.png" width = "500">

See a few values from all the columns:
```{r}
glimpse(counties)
```

### 1.2 select()
`select()` extracts only a few variables from the dataset.
```{r}
counties %>%
  select(state, county, population, unemployment)
```
Create a new table for the selection:
```{r}
counties_selected <- counties %>%
  select(state, county, population, unemployment)
```
The observations are now in alphabetical order by state and county. We might be interested in the counties that have the highest population.

### 1.3 arrange()
`arrange()` sorts the data based on one or more variables.
```{r}
counties_selected %>%
  arrange(population)
```
Add `desc()` to sort the counties with the highest population first:
```{r}
counties_selected %>%
  arrange(desc(population))
```

### 1.4 filter()
`filter()` extracts only particular observations from a dataset, based on a condition. For examplae, filter only the counties of the state New York:
```{r}
counties_selected %>%
  arrange(desc(population)) %>%
  filter(state == "New York")
```
Filter based on logical operators:
```{r}
counties_selected %>%
  arrange(desc(population)) %>%
  filter(unemployment < 6)
```
Combine multiple conditions in a filter:
```{r}
counties_selected %>%
  arrange(desc(population)) %>%
  filter(state == "New York", 
         unemployment < 6)
```
Select some more interesting variables:
```{r}
counties_selected <- counties %>%
  select(state, county, population, private_work, public_work, unemployment)
```
Sort the observations of the `public_work` variable in descending order:
```{r}
counties_selected %>% arrange(desc(public_work))
```
Filter for counties in the state of California that have a population above 1000000:
```{r}
counties_selected %>%
  filter(state == "California", 
         population > 1000000)
```
Filter for Texas and more than 10000 people; sort in descending order of `private_work`:
```{r}
counties_selected %>%
  filter(state == "Texas", 
         population > 10000) %>%
  arrange(desc(private_work))
```

### 1.5 mutate()
Datasets don't usually have all the variables you need. `mutate()` adds new variables or change existing variables.

For example, the `unemployment` variable is in percentage form. What if you're interested in the total number of unemployed rather than as a percentage of the population?
```{r}
counties_selected %>%
  mutate(unemployed_population = population * unemployment / 100)
```
What county has the highest number of unemployed people?
```{r}
counties_selected %>%
  mutate(unemployed_population = population * unemployment / 100) %>%
  arrange(desc(unemployed_population))
```
Calculating the percentage of women in a county:
```{r}
counties %>% 
  select(state, county, population, men, women) %>%
  mutate(proportion_women = women/population * 100)